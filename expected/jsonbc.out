CREATE EXTENSION jsonbc;
-- Strings.
SELECT '""'::jsonbc;				-- OK.
 jsonbc 
--------
 ""
(1 row)

SELECT $$''$$::jsonbc;			-- ERROR, single quotes are not allowed
ERROR:  invalid input syntax for type json
LINE 1: SELECT $$''$$::jsonbc;
               ^
DETAIL:  Token "'" is invalid.
CONTEXT:  JSON data, line 1: '...
SELECT '"abc"'::jsonbc;			-- OK
 jsonbc 
--------
 "abc"
(1 row)

SELECT '"abc'::jsonbc;			-- ERROR, quotes not closed
ERROR:  invalid input syntax for type json
LINE 1: SELECT '"abc'::jsonbc;
               ^
DETAIL:  Token ""abc" is invalid.
CONTEXT:  JSON data, line 1: "abc
SELECT '"abc
def"'::jsonbc;					-- ERROR, unescaped newline in string constant
ERROR:  invalid input syntax for type json
LINE 1: SELECT '"abc
               ^
DETAIL:  Character with value 0x0a must be escaped.
CONTEXT:  JSON data, line 1: "abc
SELECT '"\n\"\\"'::jsonbc;		-- OK, legal escapes
  jsonbc  
----------
 "\n\"\\"
(1 row)

SELECT '"\v"'::jsonbc;			-- ERROR, not a valid JSON escape
ERROR:  invalid input syntax for type json
LINE 1: SELECT '"\v"'::jsonbc;
               ^
DETAIL:  Escape sequence "\v" is invalid.
CONTEXT:  JSON data, line 1: "\v...
SELECT '"\u"'::jsonbc;			-- ERROR, incomplete escape
ERROR:  invalid input syntax for type json
LINE 1: SELECT '"\u"'::jsonbc;
               ^
DETAIL:  "\u" must be followed by four hexadecimal digits.
CONTEXT:  JSON data, line 1: "\u"
SELECT '"\u00"'::jsonbc;			-- ERROR, incomplete escape
ERROR:  invalid input syntax for type json
LINE 1: SELECT '"\u00"'::jsonbc;
               ^
DETAIL:  "\u" must be followed by four hexadecimal digits.
CONTEXT:  JSON data, line 1: "\u00"
SELECT '"\u000g"'::jsonbc;		-- ERROR, g is not a hex digit
ERROR:  invalid input syntax for type json
LINE 1: SELECT '"\u000g"'::jsonbc;
               ^
DETAIL:  "\u" must be followed by four hexadecimal digits.
CONTEXT:  JSON data, line 1: "\u000g...
SELECT '"\u0045"'::jsonbc;		-- OK, legal escape
 jsonbc 
--------
 "E"
(1 row)

SELECT '"\u0000"'::jsonbc;		-- ERROR, we don't support U+0000
ERROR:  unsupported Unicode escape sequence
LINE 1: SELECT '"\u0000"'::jsonbc;
               ^
DETAIL:  \u0000 cannot be converted to text.
CONTEXT:  JSON data, line 1: ...
-- use octet_length here so we don't get an odd unicode char in the
-- output
SELECT octet_length('"\uaBcD"'::jsonbc::text); -- OK, uppercase and lower case both OK
 octet_length 
--------------
            5
(1 row)

-- Numbers.
SELECT '1'::jsonbc;				-- OK
 jsonbc 
--------
 1
(1 row)

SELECT '0'::jsonbc;				-- OK
 jsonbc 
--------
 0
(1 row)

SELECT '01'::jsonbc;				-- ERROR, not valid according to JSON spec
ERROR:  invalid input syntax for type json
LINE 1: SELECT '01'::jsonbc;
               ^
DETAIL:  Token "01" is invalid.
CONTEXT:  JSON data, line 1: 01
SELECT '0.1'::jsonbc;				-- OK
 jsonbc 
--------
 0.1
(1 row)

SELECT '9223372036854775808'::jsonbc;	-- OK, even though it's too large for int8
       jsonbc        
---------------------
 9223372036854775808
(1 row)

SELECT '1e100'::jsonbc;			-- OK
                                                jsonbc                                                 
-------------------------------------------------------------------------------------------------------
 10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
(1 row)

SELECT '1.3e100'::jsonbc;			-- OK
                                                jsonbc                                                 
-------------------------------------------------------------------------------------------------------
 13000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
(1 row)

SELECT '1f2'::jsonbc;				-- ERROR
ERROR:  invalid input syntax for type json
LINE 1: SELECT '1f2'::jsonbc;
               ^
DETAIL:  Token "1f2" is invalid.
CONTEXT:  JSON data, line 1: 1f2
SELECT '0.x1'::jsonbc;			-- ERROR
ERROR:  invalid input syntax for type json
LINE 1: SELECT '0.x1'::jsonbc;
               ^
DETAIL:  Token "0.x1" is invalid.
CONTEXT:  JSON data, line 1: 0.x1
SELECT '1.3ex100'::jsonbc;		-- ERROR
ERROR:  invalid input syntax for type json
LINE 1: SELECT '1.3ex100'::jsonbc;
               ^
DETAIL:  Token "1.3ex100" is invalid.
CONTEXT:  JSON data, line 1: 1.3ex100
-- Arrays.
SELECT '[]'::jsonbc;				-- OK
 jsonbc 
--------
 []
(1 row)

SELECT '[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]'::jsonbc;  -- OK
                                                                                                  jsonbc                                                                                                  
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 [[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]]
(1 row)

SELECT '[1,2]'::jsonbc;			-- OK
 jsonbc 
--------
 [1, 2]
(1 row)

SELECT '[1,2,]'::jsonbc;			-- ERROR, trailing comma
ERROR:  invalid input syntax for type json
LINE 1: SELECT '[1,2,]'::jsonbc;
               ^
DETAIL:  Expected JSON value, but found "]".
CONTEXT:  JSON data, line 1: [1,2,]
SELECT '[1,2'::jsonbc;			-- ERROR, no closing bracket
ERROR:  invalid input syntax for type json
LINE 1: SELECT '[1,2'::jsonbc;
               ^
DETAIL:  The input string ended unexpectedly.
CONTEXT:  JSON data, line 1: [1,2
SELECT '[1,[2]'::jsonbc;			-- ERROR, no closing bracket
ERROR:  invalid input syntax for type json
LINE 1: SELECT '[1,[2]'::jsonbc;
               ^
DETAIL:  The input string ended unexpectedly.
CONTEXT:  JSON data, line 1: [1,[2]
-- Objects.
SELECT '{}'::jsonbc;				-- OK
 jsonbc 
--------
 {}
(1 row)

SELECT '{"abc"}'::jsonbc;			-- ERROR, no value
ERROR:  invalid input syntax for type json
LINE 1: SELECT '{"abc"}'::jsonbc;
               ^
DETAIL:  Expected ":", but found "}".
CONTEXT:  JSON data, line 1: {"abc"}
SELECT '{"abc":1}'::jsonbc;		-- OK
   jsonbc   
------------
 {"abc": 1}
(1 row)

SELECT '{1:"abc"}'::jsonbc;		-- ERROR, keys must be strings
ERROR:  invalid input syntax for type json
LINE 1: SELECT '{1:"abc"}'::jsonbc;
               ^
DETAIL:  Expected string or "}", but found "1".
CONTEXT:  JSON data, line 1: {1...
SELECT '{"abc",1}'::jsonbc;		-- ERROR, wrong separator
ERROR:  invalid input syntax for type json
LINE 1: SELECT '{"abc",1}'::jsonbc;
               ^
DETAIL:  Expected ":", but found ",".
CONTEXT:  JSON data, line 1: {"abc",...
SELECT '{"abc"=1}'::jsonbc;		-- ERROR, totally wrong separator
ERROR:  invalid input syntax for type json
LINE 1: SELECT '{"abc"=1}'::jsonbc;
               ^
DETAIL:  Token "=" is invalid.
CONTEXT:  JSON data, line 1: {"abc"=...
SELECT '{"abc"::1}'::jsonbc;		-- ERROR, another wrong separator
ERROR:  invalid input syntax for type json
LINE 1: SELECT '{"abc"::1}'::jsonbc;
               ^
DETAIL:  Expected JSON value, but found ":".
CONTEXT:  JSON data, line 1: {"abc"::...
SELECT '{"abc":1,"def":2,"ghi":[3,4],"hij":{"klm":5,"nop":[6]}}'::jsonbc; -- OK
                               jsonbc                               
--------------------------------------------------------------------
 {"abc": 1, "def": 2, "ghi": [3, 4], "hij": {"klm": 5, "nop": [6]}}
(1 row)

SELECT '{"abc":1:2}'::jsonbc;		-- ERROR, colon in wrong spot
ERROR:  invalid input syntax for type json
LINE 1: SELECT '{"abc":1:2}'::jsonbc;
               ^
DETAIL:  Expected "," or "}", but found ":".
CONTEXT:  JSON data, line 1: {"abc":1:...
SELECT '{"abc":1,3}'::jsonbc;		-- ERROR, no value
ERROR:  invalid input syntax for type json
LINE 1: SELECT '{"abc":1,3}'::jsonbc;
               ^
DETAIL:  Expected string, but found "3".
CONTEXT:  JSON data, line 1: {"abc":1,3...
-- Miscellaneous stuff.
SELECT 'true'::jsonbc;			-- OK
 jsonbc 
--------
 true
(1 row)

SELECT 'false'::jsonbc;			-- OK
 jsonbc 
--------
 false
(1 row)

SELECT 'null'::jsonbc;			-- OK
 jsonbc 
--------
 null
(1 row)

SELECT ' true '::jsonbc;			-- OK, even with extra whitespace
 jsonbc 
--------
 true
(1 row)

SELECT 'true false'::jsonbc;		-- ERROR, too many values
ERROR:  invalid input syntax for type json
LINE 1: SELECT 'true false'::jsonbc;
               ^
DETAIL:  Expected end of input, but found "false".
CONTEXT:  JSON data, line 1: true false
SELECT 'true, false'::jsonbc;		-- ERROR, too many values
ERROR:  invalid input syntax for type json
LINE 1: SELECT 'true, false'::jsonbc;
               ^
DETAIL:  Expected end of input, but found ",".
CONTEXT:  JSON data, line 1: true,...
SELECT 'truf'::jsonbc;			-- ERROR, not a keyword
ERROR:  invalid input syntax for type json
LINE 1: SELECT 'truf'::jsonbc;
               ^
DETAIL:  Token "truf" is invalid.
CONTEXT:  JSON data, line 1: truf
SELECT 'trues'::jsonbc;			-- ERROR, not a keyword
ERROR:  invalid input syntax for type json
LINE 1: SELECT 'trues'::jsonbc;
               ^
DETAIL:  Token "trues" is invalid.
CONTEXT:  JSON data, line 1: trues
SELECT ''::jsonbc;				-- ERROR, no value
ERROR:  invalid input syntax for type json
LINE 1: SELECT ''::jsonbc;
               ^
DETAIL:  The input string ended unexpectedly.
CONTEXT:  JSON data, line 1: 
SELECT '    '::jsonbc;			-- ERROR, no value
ERROR:  invalid input syntax for type json
LINE 1: SELECT '    '::jsonbc;
               ^
DETAIL:  The input string ended unexpectedly.
CONTEXT:  JSON data, line 1:     
-- jsonbc extraction functions
CREATE TEMP TABLE test_jsonbc (
       json_type text,
       test_json jsonbc
);
INSERT INTO test_jsonbc VALUES
('scalar','"a scalar"'),
('array','["zero", "one","two",null,"four","five", [1,2,3],{"f1":9}]'),
('object','{"field1":"val1","field2":"val2","field3":null, "field4": 4, "field5": [1,2,3], "field6": {"f1":9}}');
SELECT test_json -> 'x' FROM test_jsonbc WHERE json_type = 'scalar';
 ?column? 
----------
 
(1 row)

SELECT test_json -> 'x' FROM test_jsonbc WHERE json_type = 'array';
 ?column? 
----------
 
(1 row)

SELECT test_json -> 'x' FROM test_jsonbc WHERE json_type = 'object';
 ?column? 
----------
 
(1 row)

SELECT test_json -> 'field2' FROM test_jsonbc WHERE json_type = 'object';
 ?column? 
----------
 "val2"
(1 row)

SELECT test_json ->> 'field2' FROM test_jsonbc WHERE json_type = 'scalar';
 ?column? 
----------
 
(1 row)

SELECT test_json ->> 'field2' FROM test_jsonbc WHERE json_type = 'array';
 ?column? 
----------
 
(1 row)

SELECT test_json ->> 'field2' FROM test_jsonbc WHERE json_type = 'object';
 ?column? 
----------
 val2
(1 row)

SELECT test_json -> 2 FROM test_jsonbc WHERE json_type = 'scalar';
 ?column? 
----------
 
(1 row)

SELECT test_json -> 2 FROM test_jsonbc WHERE json_type = 'array';
 ?column? 
----------
 "two"
(1 row)

SELECT test_json -> 9 FROM test_jsonbc WHERE json_type = 'array';
 ?column? 
----------
 
(1 row)

SELECT test_json -> 2 FROM test_jsonbc WHERE json_type = 'object';
 ?column? 
----------
 
(1 row)

SELECT test_json ->> 6 FROM test_jsonbc WHERE json_type = 'array';
 ?column?  
-----------
 [1, 2, 3]
(1 row)

SELECT test_json ->> 7 FROM test_jsonbc WHERE json_type = 'array';
 ?column?  
-----------
 {"f1": 9}
(1 row)

SELECT test_json ->> 'field4' FROM test_jsonbc WHERE json_type = 'object';
 ?column? 
----------
 4
(1 row)

SELECT test_json ->> 'field5' FROM test_jsonbc WHERE json_type = 'object';
 ?column?  
-----------
 [1, 2, 3]
(1 row)

SELECT test_json ->> 'field6' FROM test_jsonbc WHERE json_type = 'object';
 ?column?  
-----------
 {"f1": 9}
(1 row)

SELECT test_json ->> 2 FROM test_jsonbc WHERE json_type = 'scalar';
 ?column? 
----------
 
(1 row)

SELECT test_json ->> 2 FROM test_jsonbc WHERE json_type = 'array';
 ?column? 
----------
 two
(1 row)

SELECT test_json ->> 2 FROM test_jsonbc WHERE json_type = 'object';
 ?column? 
----------
 
(1 row)

SELECT jsonbc_object_keys(test_json) FROM test_jsonbc WHERE json_type = 'scalar';
ERROR:  cannot call jsonbc_object_keys on a scalar
SELECT jsonbc_object_keys(test_json) FROM test_jsonbc WHERE json_type = 'array';
ERROR:  cannot call jsonbc_object_keys on an array
SELECT jsonbc_object_keys(test_json) FROM test_jsonbc WHERE json_type = 'object';
 jsonbc_object_keys 
--------------------
 field1
 field2
 field3
 field4
 field5
 field6
(6 rows)

-- nulls
SELECT (test_json->'field3') IS NULL AS expect_false FROM test_jsonbc WHERE json_type = 'object';
 expect_false 
--------------
 f
(1 row)

SELECT (test_json->>'field3') IS NULL AS expect_true FROM test_jsonbc WHERE json_type = 'object';
 expect_true 
-------------
 t
(1 row)

SELECT (test_json->3) IS NULL AS expect_false FROM test_jsonbc WHERE json_type = 'array';
 expect_false 
--------------
 f
(1 row)

SELECT (test_json->>3) IS NULL AS expect_true FROM test_jsonbc WHERE json_type = 'array';
 expect_true 
-------------
 t
(1 row)

-- corner cases
select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc -> null::text;
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc -> null::int;
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc -> 1;
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc -> 'z';
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc -> '';
 ?column? 
----------
 
(1 row)

select '[{"b": "c"}, {"b": "cc"}]'::jsonbc -> 1;
  ?column?   
-------------
 {"b": "cc"}
(1 row)

select '[{"b": "c"}, {"b": "cc"}]'::jsonbc -> 3;
 ?column? 
----------
 
(1 row)

select '[{"b": "c"}, {"b": "cc"}]'::jsonbc -> 'z';
 ?column? 
----------
 
(1 row)

select '{"a": "c", "b": null}'::jsonbc -> 'b';
 ?column? 
----------
 null
(1 row)

select '"foo"'::jsonbc -> 1;
 ?column? 
----------
 
(1 row)

select '"foo"'::jsonbc -> 'z';
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc ->> null::text;
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc ->> null::int;
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc ->> 1;
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc ->> 'z';
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc ->> '';
 ?column? 
----------
 
(1 row)

select '[{"b": "c"}, {"b": "cc"}]'::jsonbc ->> 1;
  ?column?   
-------------
 {"b": "cc"}
(1 row)

select '[{"b": "c"}, {"b": "cc"}]'::jsonbc ->> 3;
 ?column? 
----------
 
(1 row)

select '[{"b": "c"}, {"b": "cc"}]'::jsonbc ->> 'z';
 ?column? 
----------
 
(1 row)

select '{"a": "c", "b": null}'::jsonbc ->> 'b';
 ?column? 
----------
 
(1 row)

select '"foo"'::jsonbc ->> 1;
 ?column? 
----------
 
(1 row)

select '"foo"'::jsonbc ->> 'z';
 ?column? 
----------
 
(1 row)

-- equality and inequality
SELECT '{"x":"y"}'::jsonbc = '{"x":"y"}'::jsonbc;
 ?column? 
----------
 t
(1 row)

SELECT '{"x":"y"}'::jsonbc = '{"x":"z"}'::jsonbc;
 ?column? 
----------
 f
(1 row)

SELECT '{"x":"y"}'::jsonbc <> '{"x":"y"}'::jsonbc;
 ?column? 
----------
 f
(1 row)

SELECT '{"x":"y"}'::jsonbc <> '{"x":"z"}'::jsonbc;
 ?column? 
----------
 t
(1 row)

-- containment
SELECT jsonbc_contains('{"a":"b", "b":1, "c":null}', '{"a":"b"}');
 jsonbc_contains 
-----------------
 t
(1 row)

SELECT jsonbc_contains('{"a":"b", "b":1, "c":null}', '{"a":"b", "c":null}');
 jsonbc_contains 
-----------------
 t
(1 row)

SELECT jsonbc_contains('{"a":"b", "b":1, "c":null}', '{"a":"b", "g":null}');
 jsonbc_contains 
-----------------
 f
(1 row)

SELECT jsonbc_contains('{"a":"b", "b":1, "c":null}', '{"g":null}');
 jsonbc_contains 
-----------------
 f
(1 row)

SELECT jsonbc_contains('{"a":"b", "b":1, "c":null}', '{"a":"c"}');
 jsonbc_contains 
-----------------
 f
(1 row)

SELECT jsonbc_contains('{"a":"b", "b":1, "c":null}', '{"a":"b"}');
 jsonbc_contains 
-----------------
 t
(1 row)

SELECT jsonbc_contains('{"a":"b", "b":1, "c":null}', '{"a":"b", "c":"q"}');
 jsonbc_contains 
-----------------
 f
(1 row)

SELECT '{"a":"b", "b":1, "c":null}'::jsonbc @> '{"a":"b"}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":"b", "b":1, "c":null}'::jsonbc @> '{"a":"b", "c":null}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":"b", "b":1, "c":null}'::jsonbc @> '{"a":"b", "g":null}';
 ?column? 
----------
 f
(1 row)

SELECT '{"a":"b", "b":1, "c":null}'::jsonbc @> '{"g":null}';
 ?column? 
----------
 f
(1 row)

SELECT '{"a":"b", "b":1, "c":null}'::jsonbc @> '{"a":"c"}';
 ?column? 
----------
 f
(1 row)

SELECT '{"a":"b", "b":1, "c":null}'::jsonbc @> '{"a":"b"}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":"b", "b":1, "c":null}'::jsonbc @> '{"a":"b", "c":"q"}';
 ?column? 
----------
 f
(1 row)

SELECT '[1,2]'::jsonbc @> '[1,2,2]'::jsonbc;
 ?column? 
----------
 t
(1 row)

SELECT '[1,1,2]'::jsonbc @> '[1,2,2]'::jsonbc;
 ?column? 
----------
 t
(1 row)

SELECT '[[1,2]]'::jsonbc @> '[[1,2,2]]'::jsonbc;
 ?column? 
----------
 t
(1 row)

SELECT '[1,2,2]'::jsonbc <@ '[1,2]'::jsonbc;
 ?column? 
----------
 t
(1 row)

SELECT '[1,2,2]'::jsonbc <@ '[1,1,2]'::jsonbc;
 ?column? 
----------
 t
(1 row)

SELECT '[[1,2,2]]'::jsonbc <@ '[[1,2]]'::jsonbc;
 ?column? 
----------
 t
(1 row)

SELECT jsonbc_contained('{"a":"b"}', '{"a":"b", "b":1, "c":null}');
 jsonbc_contained 
------------------
 t
(1 row)

SELECT jsonbc_contained('{"a":"b", "c":null}', '{"a":"b", "b":1, "c":null}');
 jsonbc_contained 
------------------
 t
(1 row)

SELECT jsonbc_contained('{"a":"b", "g":null}', '{"a":"b", "b":1, "c":null}');
 jsonbc_contained 
------------------
 f
(1 row)

SELECT jsonbc_contained('{"g":null}', '{"a":"b", "b":1, "c":null}');
 jsonbc_contained 
------------------
 f
(1 row)

SELECT jsonbc_contained('{"a":"c"}', '{"a":"b", "b":1, "c":null}');
 jsonbc_contained 
------------------
 f
(1 row)

SELECT jsonbc_contained('{"a":"b"}', '{"a":"b", "b":1, "c":null}');
 jsonbc_contained 
------------------
 t
(1 row)

SELECT jsonbc_contained('{"a":"b", "c":"q"}', '{"a":"b", "b":1, "c":null}');
 jsonbc_contained 
------------------
 f
(1 row)

SELECT '{"a":"b"}'::jsonbc <@ '{"a":"b", "b":1, "c":null}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":"b", "c":null}'::jsonbc <@ '{"a":"b", "b":1, "c":null}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":"b", "g":null}'::jsonbc <@ '{"a":"b", "b":1, "c":null}';
 ?column? 
----------
 f
(1 row)

SELECT '{"g":null}'::jsonbc <@ '{"a":"b", "b":1, "c":null}';
 ?column? 
----------
 f
(1 row)

SELECT '{"a":"c"}'::jsonbc <@ '{"a":"b", "b":1, "c":null}';
 ?column? 
----------
 f
(1 row)

SELECT '{"a":"b"}'::jsonbc <@ '{"a":"b", "b":1, "c":null}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":"b", "c":"q"}'::jsonbc <@ '{"a":"b", "b":1, "c":null}';
 ?column? 
----------
 f
(1 row)

-- Raw scalar may contain another raw scalar, array may contain a raw scalar
SELECT '[5]'::jsonbc @> '[5]';
 ?column? 
----------
 t
(1 row)

SELECT '5'::jsonbc @> '5';
 ?column? 
----------
 t
(1 row)

SELECT '[5]'::jsonbc @> '5';
 ?column? 
----------
 t
(1 row)

-- But a raw scalar cannot contain an array
SELECT '5'::jsonbc @> '[5]';
 ?column? 
----------
 f
(1 row)

-- In general, one thing should always contain itself. Test array containment:
SELECT '["9", ["7", "3"], 1]'::jsonbc @> '["9", ["7", "3"], 1]'::jsonbc;
 ?column? 
----------
 t
(1 row)

SELECT '["9", ["7", "3"], ["1"]]'::jsonbc @> '["9", ["7", "3"], ["1"]]'::jsonbc;
 ?column? 
----------
 t
(1 row)

-- array containment string matching confusion bug
SELECT '{ "name": "Bob", "tags": [ "enim", "qui"]}'::jsonbc @> '{"tags":["qu"]}';
 ?column? 
----------
 f
(1 row)

-- array length
SELECT jsonbc_array_length('[1,2,3,{"f1":1,"f2":[5,6]},4]');
 jsonbc_array_length 
---------------------
                   5
(1 row)

SELECT jsonbc_array_length('[]');
 jsonbc_array_length 
---------------------
                   0
(1 row)

SELECT jsonbc_array_length('{"f1":1,"f2":[5,6]}');
ERROR:  cannot get array length of a non-array
SELECT jsonbc_array_length('4');
ERROR:  cannot get array length of a scalar
-- each
SELECT jsonbc_each('{"f1":[1,2,3],"f2":{"f3":1},"f4":null}');
    jsonbc_each     
--------------------
 (f1,"[1, 2, 3]")
 (f2,"{""f3"": 1}")
 (f4,null)
(3 rows)

SELECT jsonbc_each('{"a":{"b":"c","c":"b","1":"first"},"b":[1,2],"c":"cc","1":"first","n":null}'::jsonbc) AS q;
                          q                           
------------------------------------------------------
 (a,"{""b"": ""c"", ""c"": ""b"", ""1"": ""first""}")
 (b,"[1, 2]")
 (c,"""cc""")
 (1,"""first""")
 (n,null)
(5 rows)

SELECT * FROM jsonbc_each('{"f1":[1,2,3],"f2":{"f3":1},"f4":null,"f5":99,"f6":"stringy"}') q;
 key |   value   
-----+-----------
 f1  | [1, 2, 3]
 f2  | {"f3": 1}
 f4  | null
 f5  | 99
 f6  | "stringy"
(5 rows)

SELECT * FROM jsonbc_each('{"a":{"b":"c","c":"b","1":"first"},"b":[1,2],"c":"cc","1":"first","n":null}'::jsonbc) AS q;
 key |               value                
-----+------------------------------------
 a   | {"b": "c", "c": "b", "1": "first"}
 b   | [1, 2]
 c   | "cc"
 1   | "first"
 n   | null
(5 rows)

SELECT jsonbc_each_text('{"f1":[1,2,3],"f2":{"f3":1},"f4":null,"f5":"null"}');
  jsonbc_each_text  
--------------------
 (f1,"[1, 2, 3]")
 (f2,"{""f3"": 1}")
 (f4,)
 (f5,null)
(4 rows)

SELECT jsonbc_each_text('{"a":{"b":"c","c":"b","1":"first"},"b":[1,2],"c":"cc","1":"first","n":null}'::jsonbc) AS q;
                          q                           
------------------------------------------------------
 (a,"{""b"": ""c"", ""c"": ""b"", ""1"": ""first""}")
 (b,"[1, 2]")
 (c,cc)
 (1,first)
 (n,)
(5 rows)

SELECT * FROM jsonbc_each_text('{"f1":[1,2,3],"f2":{"f3":1},"f4":null,"f5":99,"f6":"stringy"}') q;
 key |   value   
-----+-----------
 f1  | [1, 2, 3]
 f2  | {"f3": 1}
 f4  | 
 f5  | 99
 f6  | stringy
(5 rows)

SELECT * FROM jsonbc_each_text('{"a":{"b":"c","c":"b","1":"first"},"b":[1,2],"c":"cc","1":"first","n":null}'::jsonbc) AS q;
 key |               value                
-----+------------------------------------
 a   | {"b": "c", "c": "b", "1": "first"}
 b   | [1, 2]
 c   | cc
 1   | first
 n   | 
(5 rows)

-- exists
SELECT jsonbc_exists('{"a":null, "b":"qq"}', 'a');
 jsonbc_exists 
---------------
 t
(1 row)

SELECT jsonbc_exists('{"a":null, "b":"qq"}', 'b');
 jsonbc_exists 
---------------
 t
(1 row)

SELECT jsonbc_exists('{"a":null, "b":"qq"}', 'c');
 jsonbc_exists 
---------------
 f
(1 row)

SELECT jsonbc_exists('{"a":"null", "b":"qq"}', 'a');
 jsonbc_exists 
---------------
 t
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ? 'a';
 ?column? 
----------
 t
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ? 'b';
 ?column? 
----------
 t
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ? 'c';
 ?column? 
----------
 f
(1 row)

SELECT jsonbc '{"a":"null", "b":"qq"}' ? 'a';
 ?column? 
----------
 t
(1 row)

CREATE TABLE testjsonbc (
       j jsonbc
);
\copy testjsonbc from 'data/jsonbc.data'
-- array exists - array elements should behave as keys
SELECT count(*) from testjsonbc  WHERE j->'array' ? 'bar';
 count 
-------
     3
(1 row)

-- type sensitive array exists - should return no rows (since "exists" only
-- matches strings that are either object keys or array elements)
SELECT count(*) from testjsonbc  WHERE j->'array' ? '5'::text;
 count 
-------
     0
(1 row)

-- However, a raw scalar is *contained* within the array
SELECT count(*) from testjsonbc  WHERE j->'array' @> '5'::jsonbc;
 count 
-------
     1
(1 row)

SELECT jsonbc_exists_any('{"a":null, "b":"qq"}', ARRAY['a','b']);
 jsonbc_exists_any 
-------------------
 t
(1 row)

SELECT jsonbc_exists_any('{"a":null, "b":"qq"}', ARRAY['b','a']);
 jsonbc_exists_any 
-------------------
 t
(1 row)

SELECT jsonbc_exists_any('{"a":null, "b":"qq"}', ARRAY['c','a']);
 jsonbc_exists_any 
-------------------
 t
(1 row)

SELECT jsonbc_exists_any('{"a":null, "b":"qq"}', ARRAY['c','d']);
 jsonbc_exists_any 
-------------------
 f
(1 row)

SELECT jsonbc_exists_any('{"a":null, "b":"qq"}', '{}'::text[]);
 jsonbc_exists_any 
-------------------
 f
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?| ARRAY['a','b'];
 ?column? 
----------
 t
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?| ARRAY['b','a'];
 ?column? 
----------
 t
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?| ARRAY['c','a'];
 ?column? 
----------
 t
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?| ARRAY['c','d'];
 ?column? 
----------
 f
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?| '{}'::text[];
 ?column? 
----------
 f
(1 row)

SELECT jsonbc_exists_all('{"a":null, "b":"qq"}', ARRAY['a','b']);
 jsonbc_exists_all 
-------------------
 t
(1 row)

SELECT jsonbc_exists_all('{"a":null, "b":"qq"}', ARRAY['b','a']);
 jsonbc_exists_all 
-------------------
 t
(1 row)

SELECT jsonbc_exists_all('{"a":null, "b":"qq"}', ARRAY['c','a']);
 jsonbc_exists_all 
-------------------
 f
(1 row)

SELECT jsonbc_exists_all('{"a":null, "b":"qq"}', ARRAY['c','d']);
 jsonbc_exists_all 
-------------------
 f
(1 row)

SELECT jsonbc_exists_all('{"a":null, "b":"qq"}', '{}'::text[]);
 jsonbc_exists_all 
-------------------
 t
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?& ARRAY['a','b'];
 ?column? 
----------
 t
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?& ARRAY['b','a'];
 ?column? 
----------
 t
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?& ARRAY['c','a'];
 ?column? 
----------
 f
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?& ARRAY['c','d'];
 ?column? 
----------
 f
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?& ARRAY['a','a', 'b', 'b', 'b'];
 ?column? 
----------
 t
(1 row)

SELECT jsonbc '{"a":null, "b":"qq"}' ?& '{}'::text[];
 ?column? 
----------
 t
(1 row)

-- typeof
SELECT jsonbc_typeof('{}') AS object;
 object 
--------
 object
(1 row)

SELECT jsonbc_typeof('{"c":3,"p":"o"}') AS object;
 object 
--------
 object
(1 row)

SELECT jsonbc_typeof('[]') AS array;
 array 
-------
 array
(1 row)

SELECT jsonbc_typeof('["a", 1]') AS array;
 array 
-------
 array
(1 row)

SELECT jsonbc_typeof('null') AS "null";
 null 
------
 null
(1 row)

SELECT jsonbc_typeof('1') AS number;
 number 
--------
 number
(1 row)

SELECT jsonbc_typeof('-1') AS number;
 number 
--------
 number
(1 row)

SELECT jsonbc_typeof('1.0') AS number;
 number 
--------
 number
(1 row)

SELECT jsonbc_typeof('1e2') AS number;
 number 
--------
 number
(1 row)

SELECT jsonbc_typeof('-1.0') AS number;
 number 
--------
 number
(1 row)

SELECT jsonbc_typeof('true') AS boolean;
 boolean 
---------
 boolean
(1 row)

SELECT jsonbc_typeof('false') AS boolean;
 boolean 
---------
 boolean
(1 row)

SELECT jsonbc_typeof('"hello"') AS string;
 string 
--------
 string
(1 row)

SELECT jsonbc_typeof('"true"') AS string;
 string 
--------
 string
(1 row)

SELECT jsonbc_typeof('"1.0"') AS string;
 string 
--------
 string
(1 row)

-- extract_path, extract_path_as_text
SELECT jsonbc_extract_path('{"f2":{"f3":1},"f4":{"f5":99,"f6":"stringy"}}','f4','f6');
 jsonbc_extract_path 
---------------------
 "stringy"
(1 row)

SELECT jsonbc_extract_path('{"f2":{"f3":1},"f4":{"f5":99,"f6":"stringy"}}','f2');
 jsonbc_extract_path 
---------------------
 {"f3": 1}
(1 row)

SELECT jsonbc_extract_path('{"f2":["f3",1],"f4":{"f5":99,"f6":"stringy"}}','f2',0::text);
 jsonbc_extract_path 
---------------------
 "f3"
(1 row)

SELECT jsonbc_extract_path('{"f2":["f3",1],"f4":{"f5":99,"f6":"stringy"}}','f2',1::text);
 jsonbc_extract_path 
---------------------
 1
(1 row)

SELECT jsonbc_extract_path_text('{"f2":{"f3":1},"f4":{"f5":99,"f6":"stringy"}}','f4','f6');
 jsonbc_extract_path_text 
--------------------------
 stringy
(1 row)

SELECT jsonbc_extract_path_text('{"f2":{"f3":1},"f4":{"f5":99,"f6":"stringy"}}','f2');
 jsonbc_extract_path_text 
--------------------------
 {"f3": 1}
(1 row)

SELECT jsonbc_extract_path_text('{"f2":["f3",1],"f4":{"f5":99,"f6":"stringy"}}','f2',0::text);
 jsonbc_extract_path_text 
--------------------------
 f3
(1 row)

SELECT jsonbc_extract_path_text('{"f2":["f3",1],"f4":{"f5":99,"f6":"stringy"}}','f2',1::text);
 jsonbc_extract_path_text 
--------------------------
 1
(1 row)

-- extract_path nulls
SELECT jsonbc_extract_path('{"f2":{"f3":1},"f4":{"f5":null,"f6":"stringy"}}','f4','f5') IS NULL AS expect_false;
 expect_false 
--------------
 f
(1 row)

SELECT jsonbc_extract_path_text('{"f2":{"f3":1},"f4":{"f5":null,"f6":"stringy"}}','f4','f5') IS NULL AS expect_true;
 expect_true 
-------------
 t
(1 row)

SELECT jsonbc_extract_path('{"f2":{"f3":1},"f4":[0,1,2,null]}','f4','3') IS NULL AS expect_false;
 expect_false 
--------------
 f
(1 row)

SELECT jsonbc_extract_path_text('{"f2":{"f3":1},"f4":[0,1,2,null]}','f4','3') IS NULL AS expect_true;
 expect_true 
-------------
 t
(1 row)

-- extract_path operators
SELECT '{"f2":{"f3":1},"f4":{"f5":99,"f6":"stringy"}}'::jsonbc#>array['f4','f6'];
 ?column?  
-----------
 "stringy"
(1 row)

SELECT '{"f2":{"f3":1},"f4":{"f5":99,"f6":"stringy"}}'::jsonbc#>array['f2'];
 ?column?  
-----------
 {"f3": 1}
(1 row)

SELECT '{"f2":["f3",1],"f4":{"f5":99,"f6":"stringy"}}'::jsonbc#>array['f2','0'];
 ?column? 
----------
 "f3"
(1 row)

SELECT '{"f2":["f3",1],"f4":{"f5":99,"f6":"stringy"}}'::jsonbc#>array['f2','1'];
 ?column? 
----------
 1
(1 row)

SELECT '{"f2":{"f3":1},"f4":{"f5":99,"f6":"stringy"}}'::jsonbc#>>array['f4','f6'];
 ?column? 
----------
 stringy
(1 row)

SELECT '{"f2":{"f3":1},"f4":{"f5":99,"f6":"stringy"}}'::jsonbc#>>array['f2'];
 ?column?  
-----------
 {"f3": 1}
(1 row)

SELECT '{"f2":["f3",1],"f4":{"f5":99,"f6":"stringy"}}'::jsonbc#>>array['f2','0'];
 ?column? 
----------
 f3
(1 row)

SELECT '{"f2":["f3",1],"f4":{"f5":99,"f6":"stringy"}}'::jsonbc#>>array['f2','1'];
 ?column? 
----------
 1
(1 row)

-- corner cases for same
select '{"a": {"b":{"c": "foo"}}}'::jsonbc #> '{}';
          ?column?          
----------------------------
 {"a": {"b": {"c": "foo"}}}
(1 row)

select '[1,2,3]'::jsonbc #> '{}';
 ?column?  
-----------
 [1, 2, 3]
(1 row)

select '"foo"'::jsonbc #> '{}';
 ?column? 
----------
 "foo"
(1 row)

select '42'::jsonbc #> '{}';
 ?column? 
----------
 42
(1 row)

select 'null'::jsonbc #> '{}';
 ?column? 
----------
 null
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #> array['a'];
      ?column?       
---------------------
 {"b": {"c": "foo"}}
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #> array['a', null];
 ?column? 
----------
 
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #> array['a', ''];
 ?column? 
----------
 
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #> array['a','b'];
   ?column?   
--------------
 {"c": "foo"}
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #> array['a','b','c'];
 ?column? 
----------
 "foo"
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #> array['a','b','c','d'];
 ?column? 
----------
 
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #> array['a','z','c'];
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc #> array['a','1','b'];
 ?column? 
----------
 "cc"
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc #> array['a','z','b'];
 ?column? 
----------
 
(1 row)

select '[{"b": "c"}, {"b": "cc"}]'::jsonbc #> array['1','b'];
 ?column? 
----------
 "cc"
(1 row)

select '[{"b": "c"}, {"b": "cc"}]'::jsonbc #> array['z','b'];
 ?column? 
----------
 
(1 row)

select '[{"b": "c"}, {"b": null}]'::jsonbc #> array['1','b'];
 ?column? 
----------
 null
(1 row)

select '"foo"'::jsonbc #> array['z'];
 ?column? 
----------
 
(1 row)

select '42'::jsonbc #> array['f2'];
 ?column? 
----------
 
(1 row)

select '42'::jsonbc #> array['0'];
 ?column? 
----------
 
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #>> '{}';
          ?column?          
----------------------------
 {"a": {"b": {"c": "foo"}}}
(1 row)

select '[1,2,3]'::jsonbc #>> '{}';
 ?column?  
-----------
 [1, 2, 3]
(1 row)

select '"foo"'::jsonbc #>> '{}';
 ?column? 
----------
 foo
(1 row)

select '42'::jsonbc #>> '{}';
 ?column? 
----------
 42
(1 row)

select 'null'::jsonbc #>> '{}';
 ?column? 
----------
 
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #>> array['a'];
      ?column?       
---------------------
 {"b": {"c": "foo"}}
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #>> array['a', null];
 ?column? 
----------
 
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #>> array['a', ''];
 ?column? 
----------
 
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #>> array['a','b'];
   ?column?   
--------------
 {"c": "foo"}
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #>> array['a','b','c'];
 ?column? 
----------
 foo
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #>> array['a','b','c','d'];
 ?column? 
----------
 
(1 row)

select '{"a": {"b":{"c": "foo"}}}'::jsonbc #>> array['a','z','c'];
 ?column? 
----------
 
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc #>> array['a','1','b'];
 ?column? 
----------
 cc
(1 row)

select '{"a": [{"b": "c"}, {"b": "cc"}]}'::jsonbc #>> array['a','z','b'];
 ?column? 
----------
 
(1 row)

select '[{"b": "c"}, {"b": "cc"}]'::jsonbc #>> array['1','b'];
 ?column? 
----------
 cc
(1 row)

select '[{"b": "c"}, {"b": "cc"}]'::jsonbc #>> array['z','b'];
 ?column? 
----------
 
(1 row)

select '[{"b": "c"}, {"b": null}]'::jsonbc #>> array['1','b'];
 ?column? 
----------
 
(1 row)

select '"foo"'::jsonbc #>> array['z'];
 ?column? 
----------
 
(1 row)

select '42'::jsonbc #>> array['f2'];
 ?column? 
----------
 
(1 row)

select '42'::jsonbc #>> array['0'];
 ?column? 
----------
 
(1 row)

-- array_elements
SELECT jsonbc_array_elements('[1,true,[1,[2,3]],null,{"f1":1,"f2":[7,8,9]},false]');
   jsonbc_array_elements    
----------------------------
 1
 true
 [1, [2, 3]]
 null
 {"f1": 1, "f2": [7, 8, 9]}
 false
(6 rows)

SELECT * FROM jsonbc_array_elements('[1,true,[1,[2,3]],null,{"f1":1,"f2":[7,8,9]},false]') q;
           value            
----------------------------
 1
 true
 [1, [2, 3]]
 null
 {"f1": 1, "f2": [7, 8, 9]}
 false
(6 rows)

SELECT jsonbc_array_elements_text('[1,true,[1,[2,3]],null,{"f1":1,"f2":[7,8,9]},false,"stringy"]');
 jsonbc_array_elements_text 
----------------------------
 1
 true
 [1, [2, 3]]
 
 {"f1": 1, "f2": [7, 8, 9]}
 false
 stringy
(7 rows)

SELECT * FROM jsonbc_array_elements_text('[1,true,[1,[2,3]],null,{"f1":1,"f2":[7,8,9]},false,"stringy"]') q;
           value            
----------------------------
 1
 true
 [1, [2, 3]]
 
 {"f1": 1, "f2": [7, 8, 9]}
 false
 stringy
(7 rows)

-- populate_record
CREATE TYPE jbpop AS (a text, b int, c timestamp);
SELECT * FROM jsonbc_populate_record(NULL::jbpop,'{"a":"blurfl","x":43.2}') q;
   a    | b | c 
--------+---+---
 blurfl |   | 
(1 row)

SELECT * FROM jsonbc_populate_record(row('x',3,'2012-12-31 15:30:56')::jbpop,'{"a":"blurfl","x":43.2}') q;
   a    | b |            c             
--------+---+--------------------------
 blurfl | 3 | Mon Dec 31 15:30:56 2012
(1 row)

SELECT * FROM jsonbc_populate_record(NULL::jbpop,'{"a":"blurfl","x":43.2}') q;
   a    | b | c 
--------+---+---
 blurfl |   | 
(1 row)

SELECT * FROM jsonbc_populate_record(row('x',3,'2012-12-31 15:30:56')::jbpop,'{"a":"blurfl","x":43.2}') q;
   a    | b |            c             
--------+---+--------------------------
 blurfl | 3 | Mon Dec 31 15:30:56 2012
(1 row)

SELECT * FROM jsonbc_populate_record(NULL::jbpop,'{"a":[100,200,false],"x":43.2}') q;
         a         | b | c 
-------------------+---+---
 [100, 200, false] |   | 
(1 row)

SELECT * FROM jsonbc_populate_record(row('x',3,'2012-12-31 15:30:56')::jbpop,'{"a":[100,200,false],"x":43.2}') q;
         a         | b |            c             
-------------------+---+--------------------------
 [100, 200, false] | 3 | Mon Dec 31 15:30:56 2012
(1 row)

SELECT * FROM jsonbc_populate_record(row('x',3,'2012-12-31 15:30:56')::jbpop,'{"c":[100,200,false],"x":43.2}') q;
ERROR:  invalid input syntax for type timestamp: "[100, 200, false]"
-- populate_recordset
SELECT * FROM jsonbc_populate_recordset(NULL::jbpop,'[{"a":"blurfl","x":43.2},{"b":3,"c":"2012-01-20 10:42:53"}]') q;
   a    | b |            c             
--------+---+--------------------------
 blurfl |   | 
        | 3 | Fri Jan 20 10:42:53 2012
(2 rows)

SELECT * FROM jsonbc_populate_recordset(row('def',99,NULL)::jbpop,'[{"a":"blurfl","x":43.2},{"b":3,"c":"2012-01-20 10:42:53"}]') q;
   a    | b  |            c             
--------+----+--------------------------
 blurfl | 99 | 
 def    |  3 | Fri Jan 20 10:42:53 2012
(2 rows)

SELECT * FROM jsonbc_populate_recordset(NULL::jbpop,'[{"a":"blurfl","x":43.2},{"b":3,"c":"2012-01-20 10:42:53"}]') q;
   a    | b |            c             
--------+---+--------------------------
 blurfl |   | 
        | 3 | Fri Jan 20 10:42:53 2012
(2 rows)

SELECT * FROM jsonbc_populate_recordset(row('def',99,NULL)::jbpop,'[{"a":"blurfl","x":43.2},{"b":3,"c":"2012-01-20 10:42:53"}]') q;
   a    | b  |            c             
--------+----+--------------------------
 blurfl | 99 | 
 def    |  3 | Fri Jan 20 10:42:53 2012
(2 rows)

SELECT * FROM jsonbc_populate_recordset(row('def',99,NULL)::jbpop,'[{"a":[100,200,300],"x":43.2},{"a":{"z":true},"b":3,"c":"2012-01-20 10:42:53"}]') q;
        a        | b  |            c             
-----------------+----+--------------------------
 [100, 200, 300] | 99 | 
 {"z": true}     |  3 | Fri Jan 20 10:42:53 2012
(2 rows)

SELECT * FROM jsonbc_populate_recordset(row('def',99,NULL)::jbpop,'[{"c":[100,200,300],"x":43.2},{"a":{"z":true},"b":3,"c":"2012-01-20 10:42:53"}]') q;
ERROR:  invalid input syntax for type timestamp: "[100, 200, 300]"
SELECT * FROM jsonbc_populate_recordset(NULL::jbpop,'[{"a":"blurfl","x":43.2},{"b":3,"c":"2012-01-20 10:42:53"}]') q;
   a    | b |            c             
--------+---+--------------------------
 blurfl |   | 
        | 3 | Fri Jan 20 10:42:53 2012
(2 rows)

SELECT * FROM jsonbc_populate_recordset(row('def',99,NULL)::jbpop,'[{"a":"blurfl","x":43.2},{"b":3,"c":"2012-01-20 10:42:53"}]') q;
   a    | b  |            c             
--------+----+--------------------------
 blurfl | 99 | 
 def    |  3 | Fri Jan 20 10:42:53 2012
(2 rows)

SELECT * FROM jsonbc_populate_recordset(row('def',99,NULL)::jbpop,'[{"a":[100,200,300],"x":43.2},{"a":{"z":true},"b":3,"c":"2012-01-20 10:42:53"}]') q;
        a        | b  |            c             
-----------------+----+--------------------------
 [100, 200, 300] | 99 | 
 {"z": true}     |  3 | Fri Jan 20 10:42:53 2012
(2 rows)

-- handling of unicode surrogate pairs
SELECT octet_length((jsonbc '{ "a":  "\ud83d\ude04\ud83d\udc36" }' -> 'a')::text) AS correct_in_utf8;
 correct_in_utf8 
-----------------
              10
(1 row)

SELECT jsonbc '{ "a":  "\ud83d\ud83d" }' -> 'a'; -- 2 high surrogates in a row
ERROR:  invalid input syntax for type json
LINE 1: SELECT jsonbc '{ "a":  "\ud83d\ud83d" }' -> 'a';
                     ^
DETAIL:  Unicode high surrogate must not follow a high surrogate.
CONTEXT:  JSON data, line 1: { "a":...
SELECT jsonbc '{ "a":  "\ude04\ud83d" }' -> 'a'; -- surrogates in wrong order
ERROR:  invalid input syntax for type json
LINE 1: SELECT jsonbc '{ "a":  "\ude04\ud83d" }' -> 'a';
                     ^
DETAIL:  Unicode low surrogate must follow a high surrogate.
CONTEXT:  JSON data, line 1: { "a":...
SELECT jsonbc '{ "a":  "\ud83dX" }' -> 'a'; -- orphan high surrogate
ERROR:  invalid input syntax for type json
LINE 1: SELECT jsonbc '{ "a":  "\ud83dX" }' -> 'a';
                     ^
DETAIL:  Unicode low surrogate must follow a high surrogate.
CONTEXT:  JSON data, line 1: { "a":...
SELECT jsonbc '{ "a":  "\ude04X" }' -> 'a'; -- orphan low surrogate
ERROR:  invalid input syntax for type json
LINE 1: SELECT jsonbc '{ "a":  "\ude04X" }' -> 'a';
                     ^
DETAIL:  Unicode low surrogate must follow a high surrogate.
CONTEXT:  JSON data, line 1: { "a":...
-- handling of simple unicode escapes
SELECT jsonbc '{ "a":  "the Copyright \u00a9 sign" }' as correct_in_utf8;
        correct_in_utf8        
-------------------------------
 {"a": "the Copyright © sign"}
(1 row)

SELECT jsonbc '{ "a":  "dollar \u0024 character" }' as correct_everywhere;
     correct_everywhere      
-----------------------------
 {"a": "dollar $ character"}
(1 row)

SELECT jsonbc '{ "a":  "dollar \\u0024 character" }' as not_an_escape;
           not_an_escape           
-----------------------------------
 {"a": "dollar \\u0024 character"}
(1 row)

SELECT jsonbc '{ "a":  "null \u0000 escape" }' as fails;
ERROR:  unsupported Unicode escape sequence
LINE 1: SELECT jsonbc '{ "a":  "null \u0000 escape" }' as fails;
                     ^
DETAIL:  \u0000 cannot be converted to text.
CONTEXT:  JSON data, line 1: { "a":...
SELECT jsonbc '{ "a":  "null \\u0000 escape" }' as not_an_escape;
        not_an_escape         
------------------------------
 {"a": "null \\u0000 escape"}
(1 row)

SELECT jsonbc '{ "a":  "the Copyright \u00a9 sign" }' ->> 'a' as correct_in_utf8;
   correct_in_utf8    
----------------------
 the Copyright © sign
(1 row)

SELECT jsonbc '{ "a":  "dollar \u0024 character" }' ->> 'a' as correct_everywhere;
 correct_everywhere 
--------------------
 dollar $ character
(1 row)

SELECT jsonbc '{ "a":  "dollar \\u0024 character" }' ->> 'a' as not_an_escape;
      not_an_escape      
-------------------------
 dollar \u0024 character
(1 row)

SELECT jsonbc '{ "a":  "null \u0000 escape" }' ->> 'a' as fails;
ERROR:  unsupported Unicode escape sequence
LINE 1: SELECT jsonbc '{ "a":  "null \u0000 escape" }' ->> 'a' as fai...
                     ^
DETAIL:  \u0000 cannot be converted to text.
CONTEXT:  JSON data, line 1: { "a":...
SELECT jsonbc '{ "a":  "null \\u0000 escape" }' ->> 'a' as not_an_escape;
   not_an_escape    
--------------------
 null \u0000 escape
(1 row)

-- jsonbc_to_record and jsonbc_to_recordset
select * from jsonbc_to_record('{"a":1,"b":"foo","c":"bar"}')
    as x(a int, b text, d text);
 a |  b  | d 
---+-----+---
 1 | foo | 
(1 row)

select * from jsonbc_to_recordset('[{"a":1,"b":"foo","d":false},{"a":2,"b":"bar","c":true}]')
    as x(a int, b text, c boolean);
 a |  b  | c 
---+-----+---
 1 | foo | 
 2 | bar | t
(2 rows)

-- indexing
SELECT count(*) FROM testjsonbc WHERE j @> '{"wait":null}';
 count 
-------
     1
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"wait":"CC"}';
 count 
-------
    15
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"wait":"CC", "public":true}';
 count 
-------
     2
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"age":25}';
 count 
-------
     2
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"age":25.0}';
 count 
-------
     2
(1 row)

SELECT count(*) FROM testjsonbc WHERE j ? 'public';
 count 
-------
   194
(1 row)

SELECT count(*) FROM testjsonbc WHERE j ? 'bar';
 count 
-------
     0
(1 row)

SELECT count(*) FROM testjsonbc WHERE j ?| ARRAY['public','disabled'];
 count 
-------
   337
(1 row)

SELECT count(*) FROM testjsonbc WHERE j ?& ARRAY['public','disabled'];
 count 
-------
    42
(1 row)

CREATE INDEX jidx ON testjsonbc USING gin (j);
SET enable_seqscan = off;
SELECT count(*) FROM testjsonbc WHERE j @> '{"wait":null}';
 count 
-------
     1
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"wait":"CC"}';
 count 
-------
    15
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"wait":"CC", "public":true}';
 count 
-------
     2
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"age":25}';
 count 
-------
     2
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"age":25.0}';
 count 
-------
     2
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"array":["foo"]}';
 count 
-------
     3
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"array":["bar"]}';
 count 
-------
     3
(1 row)

-- excercise GIN_SEARCH_MODE_ALL
SELECT count(*) FROM testjsonbc WHERE j @> '{}';
 count 
-------
  1012
(1 row)

SELECT count(*) FROM testjsonbc WHERE j ? 'public';
 count 
-------
   194
(1 row)

SELECT count(*) FROM testjsonbc WHERE j ? 'bar';
 count 
-------
     0
(1 row)

SELECT count(*) FROM testjsonbc WHERE j ?| ARRAY['public','disabled'];
 count 
-------
   337
(1 row)

SELECT count(*) FROM testjsonbc WHERE j ?& ARRAY['public','disabled'];
 count 
-------
    42
(1 row)

-- array exists - array elements should behave as keys (for GIN index scans too)
CREATE INDEX jidx_array ON testjsonbc USING gin((j->'array'));
SELECT count(*) from testjsonbc  WHERE j->'array' ? 'bar';
 count 
-------
     3
(1 row)

-- type sensitive array exists - should return no rows (since "exists" only
-- matches strings that are either object keys or array elements)
SELECT count(*) from testjsonbc  WHERE j->'array' ? '5'::text;
 count 
-------
     0
(1 row)

-- However, a raw scalar is *contained* within the array
SELECT count(*) from testjsonbc  WHERE j->'array' @> '5'::jsonbc;
 count 
-------
     1
(1 row)

RESET enable_seqscan;
SELECT count(*) FROM (SELECT (jsonbc_each(j)).key FROM testjsonbc) AS wow;
 count 
-------
  4791
(1 row)

SELECT key, count(*) FROM (SELECT (jsonbc_each(j)).key FROM testjsonbc) AS wow GROUP BY key ORDER BY count DESC, key;
    key    | count 
-----------+-------
 line      |   884
 query     |   207
 pos       |   203
 node      |   202
 space     |   197
 status    |   195
 public    |   194
 title     |   190
 wait      |   190
 org       |   189
 user      |   189
 coauthors |   188
 disabled  |   185
 indexed   |   184
 cleaned   |   180
 bad       |   179
 date      |   179
 world     |   176
 state     |   172
 subtitle  |   169
 auth      |   168
 abstract  |   161
 array     |     5
 age       |     2
 foo       |     2
 fool      |     1
(26 rows)

-- sort/hash
SELECT count(distinct j) FROM testjsonbc;
 count 
-------
   894
(1 row)

SET enable_hashagg = off;
SELECT count(*) FROM (SELECT j FROM (SELECT * FROM testjsonbc UNION ALL SELECT * FROM testjsonbc) js GROUP BY j) js2;
 count 
-------
   894
(1 row)

SET enable_hashagg = on;
SET enable_sort = off;
SELECT count(*) FROM (SELECT j FROM (SELECT * FROM testjsonbc UNION ALL SELECT * FROM testjsonbc) js GROUP BY j) js2;
 count 
-------
   894
(1 row)

SELECT distinct * FROM (values (jsonbc '{}' || ''),('{}')) v(j);
 j  
----
 {}
(1 row)

SET enable_sort = on;
RESET enable_hashagg;
RESET enable_sort;
DROP INDEX jidx;
DROP INDEX jidx_array;
-- btree
CREATE INDEX jidx ON testjsonbc USING btree (j);
SET enable_seqscan = off;
SELECT count(*) FROM testjsonbc WHERE j > '{"p":1}';
 count 
-------
   884
(1 row)

SELECT count(*) FROM testjsonbc WHERE j = '{"pos":98, "line":371, "node":"CBA", "indexed":true}';
 count 
-------
     1
(1 row)

--gin path opclass
DROP INDEX jidx;
CREATE INDEX jidx ON testjsonbc USING gin (j jsonbc_path_ops);
SET enable_seqscan = off;
SELECT count(*) FROM testjsonbc WHERE j @> '{"wait":null}';
 count 
-------
     1
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"wait":"CC"}';
 count 
-------
    15
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"wait":"CC", "public":true}';
 count 
-------
     2
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"age":25}';
 count 
-------
     2
(1 row)

SELECT count(*) FROM testjsonbc WHERE j @> '{"age":25.0}';
 count 
-------
     2
(1 row)

-- excercise GIN_SEARCH_MODE_ALL
SELECT count(*) FROM testjsonbc WHERE j @> '{}';
 count 
-------
  1012
(1 row)

RESET enable_seqscan;
DROP INDEX jidx;
-- nested tests
SELECT '{"ff":{"a":12,"b":16}}'::jsonbc;
           jsonbc            
----------------------------
 {"ff": {"a": 12, "b": 16}}
(1 row)

SELECT '{"ff":{"a":12,"b":16},"qq":123}'::jsonbc;
                 jsonbc                 
---------------------------------------
 {"ff": {"a": 12, "b": 16}, "qq": 123}
(1 row)

SELECT '{"aa":["a","aaa"],"qq":{"a":12,"b":16,"c":["c1","c2"],"d":{"d1":"d1","d2":"d2","d1":"d3"}}}'::jsonbc;
                                              jsonbc                                               
--------------------------------------------------------------------------------------------------
 {"aa": ["a", "aaa"], "qq": {"a": 12, "b": 16, "c": ["c1", "c2"], "d": {"d1": "d3", "d2": "d2"}}}
(1 row)

SELECT '{"aa":["a","aaa"],"qq":{"a":"12","b":"16","c":["c1","c2"],"d":{"d1":"d1","d2":"d2"}}}'::jsonbc;
                                                jsonbc                                                 
------------------------------------------------------------------------------------------------------
 {"aa": ["a", "aaa"], "qq": {"a": "12", "b": "16", "c": ["c1", "c2"], "d": {"d1": "d1", "d2": "d2"}}}
(1 row)

SELECT '{"aa":["a","aaa"],"qq":{"a":"12","b":"16","c":["c1","c2",["c3"],{"c4":4}],"d":{"d1":"d1","d2":"d2"}}}'::jsonbc;
                                                          jsonbc                                                          
-------------------------------------------------------------------------------------------------------------------------
 {"aa": ["a", "aaa"], "qq": {"a": "12", "b": "16", "c": ["c1", "c2", ["c3"], {"c4": 4}], "d": {"d1": "d1", "d2": "d2"}}}
(1 row)

SELECT '{"ff":["a","aaa"]}'::jsonbc;
        jsonbc         
----------------------
 {"ff": ["a", "aaa"]}
(1 row)

SELECT
  '{"ff":{"a":12,"b":16},"qq":123,"x":[1,2],"Y":null}'::jsonbc -> 'ff',
  '{"ff":{"a":12,"b":16},"qq":123,"x":[1,2],"Y":null}'::jsonbc -> 'qq',
  ('{"ff":{"a":12,"b":16},"qq":123,"x":[1,2],"Y":null}'::jsonbc -> 'Y') IS NULL AS f,
  ('{"ff":{"a":12,"b":16},"qq":123,"x":[1,2],"Y":null}'::jsonbc ->> 'Y') IS NULL AS t,
   '{"ff":{"a":12,"b":16},"qq":123,"x":[1,2],"Y":null}'::jsonbc -> 'x';
      ?column?      | ?column? | f | t | ?column? 
--------------------+----------+---+---+----------
 {"a": 12, "b": 16} | 123      | f | t | [1, 2]
(1 row)

-- nested containment
SELECT '{"a":[1,2],"c":"b"}'::jsonbc @> '{"a":[1,2]}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":[2,1],"c":"b"}'::jsonbc @> '{"a":[1,2]}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":{"1":2},"c":"b"}'::jsonbc @> '{"a":[1,2]}';
 ?column? 
----------
 f
(1 row)

SELECT '{"a":{"2":1},"c":"b"}'::jsonbc @> '{"a":[1,2]}';
 ?column? 
----------
 f
(1 row)

SELECT '{"a":{"1":2},"c":"b"}'::jsonbc @> '{"a":{"1":2}}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":{"2":1},"c":"b"}'::jsonbc @> '{"a":{"1":2}}';
 ?column? 
----------
 f
(1 row)

SELECT '["a","b"]'::jsonbc @> '["a","b","c","b"]';
 ?column? 
----------
 f
(1 row)

SELECT '["a","b","c","b"]'::jsonbc @> '["a","b"]';
 ?column? 
----------
 t
(1 row)

SELECT '["a","b","c",[1,2]]'::jsonbc @> '["a",[1,2]]';
 ?column? 
----------
 t
(1 row)

SELECT '["a","b","c",[1,2]]'::jsonbc @> '["b",[1,2]]';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":[1,2],"c":"b"}'::jsonbc @> '{"a":[1]}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":[1,2],"c":"b"}'::jsonbc @> '{"a":[2]}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":[1,2],"c":"b"}'::jsonbc @> '{"a":[3]}';
 ?column? 
----------
 f
(1 row)

SELECT '{"a":[1,2,{"c":3,"x":4}],"c":"b"}'::jsonbc @> '{"a":[{"c":3}]}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":[1,2,{"c":3,"x":4}],"c":"b"}'::jsonbc @> '{"a":[{"x":4}]}';
 ?column? 
----------
 t
(1 row)

SELECT '{"a":[1,2,{"c":3,"x":4}],"c":"b"}'::jsonbc @> '{"a":[{"x":4},3]}';
 ?column? 
----------
 f
(1 row)

SELECT '{"a":[1,2,{"c":3,"x":4}],"c":"b"}'::jsonbc @> '{"a":[{"x":4},1]}';
 ?column? 
----------
 t
(1 row)

-- nested object field / array index lookup
SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc -> 'n';
 ?column? 
----------
 null
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc -> 'a';
 ?column? 
----------
 1
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc -> 'b';
 ?column? 
----------
 [1, 2]
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc -> 'c';
 ?column? 
----------
 {"1": 2}
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc -> 'd';
   ?column?    
---------------
 {"1": [2, 3]}
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc -> 'd' -> '1';
 ?column? 
----------
 [2, 3]
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc -> 'e';
 ?column? 
----------
 
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc -> 0; --expecting error
 ?column? 
----------
 
(1 row)

SELECT '["a","b","c",[1,2],null]'::jsonbc -> 0;
 ?column? 
----------
 "a"
(1 row)

SELECT '["a","b","c",[1,2],null]'::jsonbc -> 1;
 ?column? 
----------
 "b"
(1 row)

SELECT '["a","b","c",[1,2],null]'::jsonbc -> 2;
 ?column? 
----------
 "c"
(1 row)

SELECT '["a","b","c",[1,2],null]'::jsonbc -> 3;
 ?column? 
----------
 [1, 2]
(1 row)

SELECT '["a","b","c",[1,2],null]'::jsonbc -> 3 -> 1;
 ?column? 
----------
 2
(1 row)

SELECT '["a","b","c",[1,2],null]'::jsonbc -> 4;
 ?column? 
----------
 null
(1 row)

SELECT '["a","b","c",[1,2],null]'::jsonbc -> 5;
 ?column? 
----------
 
(1 row)

SELECT '["a","b","c",[1,2],null]'::jsonbc -> -1;
 ?column? 
----------
 
(1 row)

--nested path extraction
SELECT '{"a":"b","c":[1,2,3]}'::jsonbc #> '{0}';
 ?column? 
----------
 
(1 row)

SELECT '{"a":"b","c":[1,2,3]}'::jsonbc #> '{a}';
 ?column? 
----------
 "b"
(1 row)

SELECT '{"a":"b","c":[1,2,3]}'::jsonbc #> '{c}';
 ?column?  
-----------
 [1, 2, 3]
(1 row)

SELECT '{"a":"b","c":[1,2,3]}'::jsonbc #> '{c,0}';
 ?column? 
----------
 1
(1 row)

SELECT '{"a":"b","c":[1,2,3]}'::jsonbc #> '{c,1}';
 ?column? 
----------
 2
(1 row)

SELECT '{"a":"b","c":[1,2,3]}'::jsonbc #> '{c,2}';
 ?column? 
----------
 3
(1 row)

SELECT '{"a":"b","c":[1,2,3]}'::jsonbc #> '{c,3}';
 ?column? 
----------
 
(1 row)

SELECT '{"a":"b","c":[1,2,3]}'::jsonbc #> '{c,-1}';
 ?column? 
----------
 
(1 row)

SELECT '[0,1,2,[3,4],{"5":"five"}]'::jsonbc #> '{0}';
 ?column? 
----------
 0
(1 row)

SELECT '[0,1,2,[3,4],{"5":"five"}]'::jsonbc #> '{3}';
 ?column? 
----------
 [3, 4]
(1 row)

SELECT '[0,1,2,[3,4],{"5":"five"}]'::jsonbc #> '{4}';
   ?column?    
---------------
 {"5": "five"}
(1 row)

SELECT '[0,1,2,[3,4],{"5":"five"}]'::jsonbc #> '{4,5}';
 ?column? 
----------
 "five"
(1 row)

--nested exists
SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc ? 'n';
 ?column? 
----------
 t
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc ? 'a';
 ?column? 
----------
 t
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc ? 'b';
 ?column? 
----------
 t
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc ? 'c';
 ?column? 
----------
 t
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc ? 'd';
 ?column? 
----------
 t
(1 row)

SELECT '{"n":null,"a":1,"b":[1,2],"c":{"1":2},"d":{"1":[2,3]}}'::jsonbc ? 'e';
 ?column? 
----------
 f
(1 row)

